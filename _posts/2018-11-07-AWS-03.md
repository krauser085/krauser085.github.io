---
layout: post
title: AWS 사용하기 03 - DynamoDB - Capacity and Partition
date: 2018-11-07 23:17:14 +0900
description: DynamoDB 의 Capacity 에 대해서 알아보겠습니다.
img: aws.png
tags: [AWS]
---
---

##Capacity** 란?
1초에 읽거나 쓸 수 있는 용량을 이야기 합니다.
테이블 마다 Capacity 를 설정함에 따라서 필요한 트랜젝션 용량을 조절할 수 있습니다.
~~이거에 따라서 가격이 천차만별로 갈리기 때문에 잘배워 둬야됨~~

## RCU(Read Capacity Units) 와 WCU(Write Capacity Units)
  읽을 때의 capacity를 **RCU** 쓸때의 Capacity 를 **WCU** 라고 합니다.
  RCU 와 WCU 는 같은 1 capacity 라고 허용 용량이 다르기 때문에 기억해 놓을 필요가 있습니다.
  - **RCU** 는 1 capacity 에 4kb 의 데이터를 읽을 수 있습니다. **1 capacity = 4kb**
  - **WCU** 는 1 capacity 에 1kb 의 데이터를 읽을 수 있습니다. **1 capacity = 1kb**

### RCUs
  **RCU** 에 대해 좀더 자세히 알아보겠습니다.
  **RCU** 는 다시 일관된 읽기(Eventually Consistent Read) 와 강력한 일관된 읽기(Strongly Consistent Read) 로 나뉠 수 있습니다.
  Eventually 와 Strongly 의 차이를 이해하기 위해서는 **가용 영역** 에 대해 먼저 알아야 합니다.
  AWS 의 각 Region 에 DB 데이터가 추가 될때, 이 데이터는 해당 region 에 한곳에만 존재하는 것이 아닙니다.
  같은 리전안에서도 여러 곳으로 같은 데이터를 복사해서 보관합니다.
  이렇게 하면 크게 두가지 장점이 있습니다.
  1. 가장 네트워크 처리량이 낮은 가용영역 으로 연결 함으로써 시간 처리 비용을 낮춘다.
  2. 서로 물리적 오류로부터 분리되어 있기 때문에 안전성을 높일 수 있다.
  이런 이유 때문에 **일관적 읽기** 라고 부르는 것 같습니다.

  그렇다면 **강력한 일관적 읽기** 란 무엇일까요?
  한마디로 이야기 한다면 **일관적 읽기** 를 보완한 것 입니다.
  만약 새로운 데이터를 DB 에 추가한다고 가정했을 때,
  먼저 가장 네트워크 지연이 낮은 가용영역으로 연결되어 데이터를 저장합니다.
  => 그리고 나서 다른 나머지 가용영역들에 데이터를 저장하는데... 바로 여기서 시간 지연이 길게는 1초까지 발생할 수 있습니다.

  때문에 A 라는 사람이 DB 에 데이터를 추가 or 갱신 하고 있을 때, 거의 같은 타이밍에 B 라는 사람이 데이터를 요청한다면 이 데이터를 최신이 아닐 수 있다는 뜻 입니다.
  이 문제를 보안하기 위한 것이 **Strongly Consistent Read** 입니다.
  Strongly Consistent Read 는 가장 최신의 데이터가 반환되는 것을 보장합니다. ~~하지만 일관된 읽기 보다는 느릴 수 있을 것같네요~~
  옵션을 지정하지 않은 **default** 상태에서는 **일관된 읽기**로 데이터를 불러오게 됩니다.

  - 일관된 읽기(Eventually Consistent Read) 와 강력한 일관된 읽기(Strongly Consistent Read) 의 데이터량 차이<br/>

  |일관된 읽기|강력한 일관된 읽기|
  |---|---|
  |4k * 2 = 8k | 4k|
  위에서 보시는 바와 같이 일관된 읽기의 경우 1개의 capacity에 최대 8k 의 데이터 까지 읽을 수 있습니다.

  - 예) item 당 9k 의 데이터 15개를 읽을 경우의 필요한 capacity 수(일관된 읽기)
  > 9k / 8k(일관된 읽기 최대치) = 1.125 => 올림 => 2개 (아이템 하나당 필요한 capacity 수)
  > 2 capacity * 15 개 = 30 capacity

### WCUs
  WCUs 경우 앞서 말씀드렸듯이 1 capacity 당 1kb 의 데이터를 쓸 수 있습니다.

  - 예) item 당 9k 의 데이터 15개를 등록할 경우의 필요한 capacity 수
  > 9k/ 1k * 15 개 = 135 capacity
